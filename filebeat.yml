filebeat.config:
    modules:
        path: ${path.config}/modules.d/*.yml
        reload.enabled: false

# 收集 Docker 容器日志
filebeat.inputs:
    - type: container
      paths:
          - /var/lib/docker/containers/*/*.log
      processors:
          - add_docker_metadata:
                host: "unix:///var/run/docker.sock"
          - add_host_metadata: ~
          - add_cloud_metadata: ~
          - add_kubernetes_metadata: ~
      fields:
          type: container_log
      fields_under_root: true

    # 收集应用程序日志
    - type: log
      enabled: true
      paths:
          - /var/log/app/*.log
      fields:
          type: app_log
          app: im_message
      fields_under_root: true
      json.keys_under_root: true
      json.add_error_key: true

# 输出到 Elasticsearch
output.elasticsearch:
    hosts: ["elasticsearch:9200"]
    index: "im-message-%{+yyyy.MM.dd}"

# 设置 Kibana 仪表盘
setup:
    kibana:
        host: "kibana:5601"
    dashboards:
        enabled: true
    template:
        name: "im-message"
        pattern: "im-message-*"
        enabled: true
